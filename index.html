<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soumission de Projets</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .hidden { display: none; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
        button { padding: 10px 15px; cursor: pointer; }
        .projet { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; position: relative; }
        .like-button { cursor: pointer; color: blue; }
        .delete-button { position: absolute; top: 5px; right: 5px; background-color: red; color: white; font-size: 12px; padding: 2px 5px; border: none; cursor: pointer; }
        .delete-button:hover { opacity: 0.8; }
    </style>
    <!-- Importer les bibliothèques Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.12.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.12.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.12.0/firebase-analytics.js"></script>
</head>
<body>

    <h1>Soumission de Projets</h1>
    <button id="projetButton">J'ai un projet</button>

    <!-- Formulaire caché au départ -->
    <div id="projetForm">
        <textarea id="projetInput" placeholder="Décris ton projet..."></textarea>
        <button id="submitButton">Envoyer</button>
    </div>

    <h2>Liste des Projets</h2>
    <div id="projetsContainer"></div>

    <script>
        // Configuration de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyATBBmuIx94ZrOAY56KUdX2YUdQWbakdJY",
            authDomain: "vos-projets.firebaseapp.com",
            databaseURL: "https://vos-projets-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "vos-projets",
            storageBucket: "vos-projets.appspot.com",
            messagingSenderId: "12303899246",
            appId: "1:12303899246:web:b4b069e7082a1279e3647f",
            measurementId: "G-VK5K6QRW26"
        };

        // Initialiser Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const analytics = firebase.getAnalytics(app);
        const database = firebase.database();

        // Afficher le formulaire de soumission
        document.getElementById("projetButton").addEventListener("click", function() {
            document.getElementById("projetForm").classList.toggle("hidden");
        });

        // Sauvegarder le projet soumis
        document.getElementById("submitButton").addEventListener("click", async function() {
            let projetText = document.getElementById("projetInput").value;

            if (projetText.trim() !== "") {
                // Ajouter le projet à la Realtime Database
                let newProjetRef = database.ref("projets").push();
                await newProjetRef.set({ texte: projetText, likes: 0 });
                document.getElementById("projetInput").value = "";  // Vider le champ de saisie

                // Réafficher les projets
                afficherProjets();
            } else {
                alert("Veuillez entrer un projet.");
            }
        });

        // Fonction pour afficher la liste des projets
        async function afficherProjets() {
            let projetsContainer = document.getElementById("projetsContainer");
            projetsContainer.innerHTML = "";  // Réinitialiser la liste

            // Charger les projets depuis la Realtime Database
            const projetsSnapshot = await database.ref("projets").once("value");
            const projets = projetsSnapshot.val();

            // Convertir les projets en tableau et les trier par likes
            let projetsArray = [];
            for (const key in projets) {
                projetsArray.push({ id: key, ...projets[key] });
            }
            projetsArray.sort((a, b) => b.likes - a.likes); // Tri décroissant

            // Afficher chaque projet
            projetsArray.forEach(projet => {
                let projetDiv = document.createElement("div");
                projetDiv.className = "projet";
                projetDiv.innerHTML = `
                    <p>${projet.texte}</p>
                    <button class="like-button" onclick="likerProjet('${projet.id}')">Like (${projet.likes})</button>
                    <button class="delete-button" onclick="supprimerProjet('${projet.id}')">Supprimer</button>
                `;
                projetsContainer.appendChild(projetDiv);
            });
        }

        // Fonction pour liker un projet
        async function likerProjet(docId) {
            // Récupérer le projet dans la Realtime Database
            let projetRef = database.ref("projets/" + docId);
            await projetRef.transaction(projet => {
                if (projet) {
                    projet.likes = (projet.likes || 0) + 1;
                }
                return projet;
            });

            // Réafficher les projets mis à jour
            afficherProjets();
        }

        // Fonction pour supprimer un projet
        async function supprimerProjet(docId) {
            // Demander le mot de passe
            let password = prompt("Veuillez entrer le mot de passe pour supprimer ce projet :");

            // Vérifier si le mot de passe est correct
            if (password === "Lala3.141592") {
                // Supprimer le projet de la Realtime Database
                await database.ref("projets/" + docId).remove();
                // Réafficher les projets mis à jour
                afficherProjets();
            } else {
                alert("Mot de passe incorrect.");
            }
        }

        // Charger les projets dès l'ouverture de la page
        afficherProjets();
    </script>

</body>
</html>
